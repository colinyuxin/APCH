% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ashr_grid_distillation.R
\name{ashr_grid_distill}
\alias{ashr_grid_distill}
\title{Distill an ashr mixture grid for a single feature}
\usage{
ashr_grid_distill(
  x,
  s,
  mixcompdist = "normal",
  lambda0 = 10,
  distill = TRUE,
  fine_mult = 1.35,
  fine_s_min_mult = 0.5,
  fine_s_max_mult = 1,
  fine_max_len = 500,
  mixsqp_control = NULL,
  mll_drop_total_tol = 2e-04,
  ks_increase_total_tol = 0.01,
  min_grid_len = 8,
  max_merges = Inf,
  pair_frac = 0.2,
  rel_thresh = 1e-06,
  verbose = TRUE
)
}
\arguments{
\item{x}{Numeric vector of effect estimates for a single feature.}

\item{s}{Numeric vector of standard errors corresponding to \code{x}.}

\item{mixcompdist}{Character specifying the slab distribution passed to
\code{\link[ashr]{ash}}. Typical values include \code{"normal"},
\code{"uniform"}, \code{"halfuniform"}, and \code{"halfnormal"}.
Default: \code{"normal"}.}

\item{lambda0}{Numeric null-biasing parameter passed as \code{nullweight}
to \code{\link[ashr]{ash}}. Larger values encourage more mass on the
point mass at zero. Default: \code{10}.}

\item{distill}{Logical; if \code{TRUE} (default), perform the full
distillation path (successive grid merges). If \code{FALSE}, only run
the initial pruning step (fine grid \eqn{\to} pruned grid).}

\item{fine_mult, fine_s_min_mult, fine_s_max_mult, fine_max_len}{Numeric
parameters controlling the initial fine grid (see internal
\code{distill_grid_path_from_xs()} and \code{make_mixsd_grid()}).}

\item{mixsqp_control}{Optional list of control parameters passed to
\code{ashr::ash()} (through its \code{control} argument for \code{mixsqp}),
typically including \code{"eps"}, \code{"maxiter"}, and \code{"verbose"}.}

\item{mll_drop_total_tol, ks_increase_total_tol}{Numeric tolerances used
to decide whether a proposed grid merge is acceptable, based on the
change in mean log-likelihood and PIT KS statistic.}

\item{min_grid_len}{Integer minimum allowed positive grid size during
distillation.}

\item{max_merges}{Maximum number of merge batches.}

\item{pair_frac}{Fraction of candidate adjacent grid pairs allowed to merge
at each batch.}

\item{rel_thresh}{Relative weight threshold used to prune very low-mass
grid components.}

\item{verbose}{Logical; if \code{TRUE}, print progress messages from
the grid construction and distillation.}
}
\value{
A list with components:
\describe{
\item{grid_final}{Numeric vector of the final signed grid values
(including sign for half-normal / half-uniform families).}
\item{pi_final}{Numeric vector of mixture weights aligned with
\code{grid_final}. The weights are renormalized to sum to 1
over the components returned here.}
\item{path_table}{Data frame summarizing the distillation path
(step index, grid size, PIT KS, mean log-likelihood, etc.).}
\item{fine_grid}{Numeric vector of the initial pruned fine grid.}
\item{steps}{Full list of steps returned by
\code{distill_grid_path_from_xs()}, each containing the grid,
\code{signed_grid}, and \code{pi} at that step.}
}
}
\description{
This helper function runs the internal grid-construction and distillation
pipeline for a single feature. It is mainly intended for inspecting and
tuning the ashr prior used in the APCH feature layer (e.g., in meta-analysis
mode), without running the full APCH pipeline.
}
\details{
Given effect estimates \code{x} and standard errors \code{s}, the function
builds a fine-scale grid of mixture standard deviations, fits \pkg{ashr}
on that grid, optionally prunes and distills the grid, and returns the
final signed grid and mixture weights, along with diagnostic information
about the distillation path.
}
\examples{
\dontrun{
set.seed(1)
n <- 2000
x <- rnorm(n)
s <- rep(1, n)

# Distill a normal-slab ashr grid
gd <- ashr_grid_distill(x, s, mixcompdist = "normal", lambda0 = 10)
gd$grid_final
gd$pi_final

# Inspect the distillation path
gd$path_table
}

}
