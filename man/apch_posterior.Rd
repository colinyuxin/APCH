% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/apch_posterior.R
\name{apch_posterior}
\alias{apch_posterior}
\title{Compute Posterior Mean and Covariance under Gaussian Mixture Model}
\usage{
apch_posterior(
  X,
  S,
  C,
  w_mat,
  cfg,
  grid_list,
  pi_list,
  mixcompdist = "normal",
  return_cov_full = TRUE,
  w_thresh = 1e-12,
  mode = c("meta", "xwas")
)
}
\arguments{
\item{X}{Matrix of observed effects (n × p).}

\item{S}{Matrix of standard errors (same dimension as \code{X}).}

\item{C}{Observation-noise structure among features. For
\code{mode = "meta"}, a single \eqn{p \times p} matrix shared across
effects (typically the global correlation matrix in meta-analysis).
For \code{mode = "xwas"}, a list of length \code{n} of \eqn{p \times p}
matrices, giving per-effect covariance matrices \eqn{C_i}.}

\item{w_mat}{Posterior weight matrix (n × K).}

\item{cfg}{Binary configuration matrix (K × p).}

\item{grid_list}{List of mixture grids (one per feature).}

\item{pi_list}{List of mixture weights (one per feature).}

\item{mixcompdist}{Character; mixture component distribution. Currently only
\code{"normal"} is supported for exact posterior computation; for other
slab families the function returns matrices of \code{NA} with an
explanatory note.}

\item{return_cov_full}{Logical; whether to compute full covariance matrices
for each effect.}

\item{w_thresh}{Numeric threshold for posterior weight truncation
(to improve stability).}

\item{mode}{Character string, either \code{"meta"} or \code{"xwas"}, matching
the interpretation of \code{C}. In \code{"meta"} mode, \code{C} is a single
matrix; in \code{"xwas"} mode, \code{C} must be a list of length \code{n}.}
}
\value{
A list containing:
\describe{
\item{mean}{Matrix of posterior means (n × p).}
\item{var_diag}{Matrix of marginal posterior variances.}
\item{cov_full}{(Optional) 3D array of full posterior covariance matrices
(p × p × n) when \code{return_cov_full = TRUE}.}
\item{note}{Character string describing any numerical approximation or
skipped computation. For non-Gaussian slabs, a note explains that the
posterior is not implemented and \code{NA}-filled matrices are returned.}
}
}
\description{
The \code{apch_posterior()} function computes posterior means, variances, and
covariances for each effect-feature pair under the Gaussian mixture model
used in APCH, given configuration-level weights and feature-level priors.
It serves as the final step of the analysis, producing interpretable
posterior summaries for downstream interpretation.
}
\examples{
\dontrun{
grid_list <- apch_res$ashr_res$signed_grids
pi_list   <- apch_res$ashr_res$pi_list
w_mat <- apch_res$em_res$w_mat
configs <- dat$configs

post_res <- apch_posterior(
  X = X,
  S = S,
  C = dat$R,
  w_mat = w_mat,
  cfg = configs,
  grid_list = grid_list,
  pi_list = pi_list,
  mixcompdist = "normal",
  return_cov_full = FALSE,
  w_thresh = 1e-12,
  mode = "meta"
)

cat("Posterior mean matrix dims:", dim(post_res$mean), "\n")
print(head(post_res$mean))
}

}
