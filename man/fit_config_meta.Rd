% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/em_interface.R
\name{fit_config_meta}
\alias{fit_config_meta}
\title{Configuration layer: block-diagonal solver (meta-analysis mode, no penalty)}
\usage{
fit_config_meta(
  X,
  S,
  R_cor,
  sgL,
  piL = NULL,
  configs,
  mixcompdist = "normal",
  tau = 1e-04,
  max_iter_A = 1e+06,
  tol_A = 1e-06,
  max_iter_B = 1e+06,
  tol_B = 1e-06,
  progress = interactive(),
  progress_chunk = 128,
  use_parallel = TRUE,
  n_threads = parallel::detectCores(logical = TRUE),
  verbose = TRUE,
  output = c("full", "light"),
  force_single_block = FALSE,
  solver_stageA = c("mixsqp", "em", "loglinear"),
  solver_stageB = c("mcmc", "mixsqp", "em", "loglinear"),
  stageA_ll_tol = 0.01,
  stageB_ll_tol = 0.01
)
}
\arguments{
\item{X}{Numeric matrix of observed effects (\eqn{n \times p}).}

\item{S}{Numeric matrix of standard errors (same shape as \code{X}).}

\item{R_cor}{Global \eqn{p \times p} correlation (or covariance) matrix.}

\item{sgL}{List of length \code{p}; \code{sgL[[j]]} is the signed mixture
grid for feature \code{j}.}

\item{piL}{Optional list of length \code{p}; \code{piL[[j]]} are the
corresponding mixture weights. When non-\code{NULL} and
\code{mixcompdist = "normal"}, single-feature blocks are fast-tracked by
reusing ashr results.}

\item{configs}{Binary configuration matrix (\eqn{K \times p}) of all global
activation patterns (strictly MSB-ordered columns).}

\item{mixcompdist}{Slab family (e.g. \code{"normal"}, \code{"uniform"}).}

\item{tau}{Threshold for block decomposition of \code{R_cor}. Default \code{1e-4}.}

\item{max_iter_A, tol_A}{Stage-A iteration limit and tolerance for EM/mixsqp.
For \code{"loglinear"} Stage A, \code{tol_A} is ignored and
\code{stageA_ll_tol} is used instead.}

\item{max_iter_B, tol_B}{Stage-B iteration limit and tolerance for EM/mixsqp.
For Stage-B \code{"loglinear"}, \code{tol_B} is ignored and
\code{stageB_ll_tol} is used instead.}

\item{progress}{Logical; whether to print Stage-A progress.}

\item{progress_chunk}{Integer chunk size for Stage-A likelihood precomputation.}

\item{use_parallel}{Logical; enable multi-threading in C++ backends.}

\item{n_threads}{Max threads for \pkg{RcppParallel} (capped to 8).}

\item{verbose}{Logical; print diagnostics. MixSQP output is silenced; we only
print a one-line convergence summary for Stage B.}

\item{output}{Either \code{"full"} (return Stage A/B details) or
\code{"light"} (only \code{w_mat} and \code{delta}).}

\item{force_single_block}{Logical; treat all features as one block in Stage A
(but still perform Stage B on the fused global configurations).}

\item{solver_stageA}{\code{"mixsqp"} (default), \code{"em"}, or
\code{"loglinear"} (softmax + L2 ridge on block-level pattern weights)
for Stage A.}

\item{solver_stageB}{\code{"mcmc"} (default), \code{"mixsqp"}, \code{"em"},
or \code{"loglinear"} for Stage B.}

\item{stageA_ll_tol}{Tolerance for Stage-A \code{"loglinear"} solver
(default \code{0.01}); ignored by other Stage-A solvers.}

\item{stageB_ll_tol}{Tolerance for Stage-B \code{"loglinear"} solver
(default \code{0.01}); ignored by other Stage-B solvers.}
}
\value{
A list:
\describe{
\item{w_mat}{Posterior configuration weights (\eqn{n \times K}).}
\item{delta}{Global configuration probabilities (length \eqn{K}).}
\item{stageA, stageB, block_logf}{(When \code{output="full"}) internals.}
}
}
\description{
Runs Stage A per block (using near block-diagonal structure in \code{R_cor}),
then fuses blocks in Stage B to obtain global configuration weights.
}
\details{
Stage A uses \code{"mixsqp"}, \code{"em"}, or \code{"loglinear"}; Stage B
can use \code{"mcmc"}, \code{"mixsqp"}, \code{"em"}, or the new
\code{"loglinear"} (Ising + ridge) solver. There is \strong{no} EB/size penalty
in Stage B. The Stage-A \code{"loglinear"} solver reparameterizes the
block-level mixture weights over \eqn{\eta}-patterns via a softmax and
adds an L2 penalty on the unconstrained parameters, using \code{stageA_ll_tol}
as its convergence tolerance (independent of \code{tol_A}).
}
\keyword{internal}
